'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import { ArrowLeft } from 'lucide-react';

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ¤œç´¢é …ç›®
const defaultSearchFields = [
  { id: '1', name: 'å›³ç•ª', enabled: true },
  { id: '2', name: 'å›³é¢ç¨®é¡', enabled: true },
  { id: '3', name: 'æ©Ÿç¨®', enabled: true },
  { id: '4', name: 'è£½å›³è€…', enabled: true },
  { id: '5', name: 'è£½å“å', enabled: true },
  { id: '6', name: 'å¤§ãã•', enabled: true },
  { id: '7', name: 'ä»•æ§˜', enabled: true },
];

// ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆç”»åƒã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«åŸºã¥ã„ã¦æ‹¡å¼µï¼‰
const sampleData = Array.from({ length: 30 }, (_, i) => ({
  å›³ç•ª: `H5FTA5${9134 + i}`,
  æ©Ÿç¨®: 'L H 5',
  å¤§ãã•: ['5 0 6 0', '2 0 5 0', '7 0 6 0', '9 0 5 0'][i % 4],
  è¦‹ç©ç•ªå·: i % 3 === 0 ? '' : `000${188018 + i}`,
  è£½å›³è€…: 'é‡‘ä¸‹å¹¸',
  ä½œæˆå¹´æœˆæ—¥: '2025.03.31',
  ä»•æ§˜å¤‰æ›´: '2 0 2 2å¹´ 1 0æœˆæ”¹å®š',
  å–¶æ¥­æ‰€: 'åºƒå³¶å–¶æ¥­æ‰€',
  ç‰¹åˆ¥ä»•æ§˜23: i % 4 === 3 ? '' : '1 8 0 0',
  ç‰¹åˆ¥ä»•æ§˜24: '',
  ç‰¹åˆ¥ä»•æ§˜27: '',
  ç‰¹åˆ¥ä»•æ§˜28: '',
  ç‰¹åˆ¥ä»•æ§˜30: '',
}));

export default function SearchPage() {
  // åˆæœŸsearchParamsã‚’ç”Ÿæˆ
  const getInitialSearchParams = () => {
    const params: Record<string, string> = {};
    defaultSearchFields.forEach((field) => {
      params[field.name] = '';
    });
    return params;
  };

  const [searchFields, setSearchFields] = useState(defaultSearchFields);
  const [searchParams, setSearchParams] = useState<Record<string, string>>(getInitialSearchParams());

  // localStorageã‹ã‚‰æ¤œç´¢é …ç›®ã‚’èª­ã¿è¾¼ã¿
  useEffect(() => {
    const saved = localStorage.getItem('searchFields');
    if (saved) {
      const fields = JSON.parse(saved);
      setSearchFields(fields);

      // æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
      const params: Record<string, string> = {};
      fields.forEach((field: any) => {
        params[field.name] = '';
      });
      setSearchParams(params);
    }
  }, []);

  const [results, setResults] = useState(sampleData);
  const [selectedRow, setSelectedRow] = useState<number | null>(0);

  const handleSearch = () => {
    setResults(sampleData);
  };

  return (
    <div className="min-h-screen bg-[#c0c0c0] p-4 font-sans">
      <div className="mx-auto max-w-7xl bg-[#c0c0c0] border-2 border-white border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080]">
        {/* ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ */}
        <div className="bg-gradient-to-r from-[#0a246a] to-[#a6caf0] px-2 py-1 flex items-center justify-between">
          <div className="flex items-center gap-2 text-white font-bold text-sm">
            <Link href="/" className="hover:bg-white/20 p-1 rounded transition-colors">
              <ArrowLeft className="w-4 h-4" />
            </Link>
            <span className="text-base">ğŸ”</span>
            <span>æ¤œç´¢</span>
          </div>
          <div className="bg-[#c0c0c0] px-3 py-0.5 text-xs border border-white border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080]">
            æ¤œç´¢ç”»é¢
          </div>
        </div>

        {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
        <div className="p-4 space-y-4">
          {/* æ¤œç´¢æ¡ä»¶ */}
          <div className="border-2 border-[#808080] border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080] p-3 bg-[#c0c0c0]">
            <div className="flex items-center justify-between mb-3">
              <div className="text-sm font-bold">æ¤œç´¢æ¡ä»¶</div>
              <Link href="/settings">
                <button className="text-xs text-blue-700 hover:underline">
                  æ¤œç´¢é …ç›®ã‚’ç·¨é›†
                </button>
              </Link>
            </div>

            <div className="grid grid-cols-4 gap-3">
              {searchFields
                .filter(field => field.enabled)
                .map((field) => (
                  <div key={field.id} className="flex items-center gap-2">
                    <label className="text-sm whitespace-nowrap">{field.name}:</label>
                    <input
                      type="text"
                      value={searchParams[field.name] || ''}
                      onChange={(e) => setSearchParams({ ...searchParams, [field.name]: e.target.value })}
                      className="flex-1 border-2 border-[#808080] border-t-[#000000] border-l-[#000000] border-b-[#ffffff] border-r-[#ffffff] px-2 py-1 bg-white text-sm"
                    />
                  </div>
                ))}
            </div>

            {/* å…ƒã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å‰Šé™¤ */}
            <div className="hidden">{/* å¤ã„æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‰Šé™¤æ¸ˆã¿ */}</div>
              {/* å›³ç•ª */}
              <div className="flex items-center gap-2">
                <label className="text-sm whitespace-nowrap">å›³ç•ª:</label>
                <input
                  type="text"
                  value={searchParams.å›³ç•ª}
                  onChange={(e) => setSearchParams({ ...searchParams, å›³ç•ª: e.target.value })}
                  className="flex-1 border-2 border-[#808080] border-t-[#000000] border-l-[#000000] border-b-[#ffffff] border-r-[#ffffff] px-2 py-1 bg-white text-sm"
                />
              </div>

              {/* å›³é¢ç¨®é¡ */}
              <div className="flex items-center gap-2">
                <label className="text-sm whitespace-nowrap">å›³é¢ç¨®é¡:</label>
                <select
                  value={searchParams.å›³é¢ç¨®é¡}
                  onChange={(e) => setSearchParams({ ...searchParams, å›³é¢ç¨®é¡: e.target.value })}
                  className="flex-1 border-2 border-[#808080] border-t-[#000000] border-l-[#000000] border-b-[#ffffff] border-r-[#ffffff] px-2 py-1 bg-white text-sm"
                >
                  <option value=""></option>
                  <option value="ç¢ºèªå›³é¢">ç¢ºèªå›³é¢</option>
                  <option value="åŸºç¤å›³">åŸºç¤å›³</option>
                  <option value="é‰„éª¨è©³ç´°å›³">é‰„éª¨è©³ç´°å›³</option>
                </select>
              </div>

              {/* æ©Ÿç¨® */}
              <div className="flex items-center gap-2">
                <label className="text-sm whitespace-nowrap">æ©Ÿç¨®:</label>
                <select
                  value={searchParams.æ©Ÿç¨®}
                  onChange={(e) => setSearchParams({ ...searchParams, æ©Ÿç¨®: e.target.value })}
                  className="flex-1 border-2 border-[#808080] border-t-[#000000] border-l-[#000000] border-b-[#ffffff] border-r-[#ffffff] px-2 py-1 bg-white text-sm"
                >
                  <option value=""></option>
                  <option value="LH5">L H 5</option>
                  <option value="KKS">KKS</option>
                  <option value="HKS">HKS</option>
                </select>
              </div>

              {/* è£½å›³è€… */}
              <div className="flex items-center gap-2">
                <label className="text-sm whitespace-nowrap">è£½å›³è€…:</label>
                <select
                  value={searchParams.è£½å›³è€…}
                  onChange={(e) => setSearchParams({ ...searchParams, è£½å›³è€…: e.target.value })}
                  className="flex-1 border-2 border-[#808080] border-t-[#000000] border-l-[#000000] border-b-[#ffffff] border-r-[#ffffff] px-2 py-1 bg-white text-sm"
                >
                  <option value=""></option>
                  <option value="é‡‘ä¸‹å¹¸">é‡‘ä¸‹å¹¸</option>
                  <option value="æ»æ¾¤å®—å½¦">æ»æ¾¤å®—å½¦</option>
                </select>
              </div>

              {/* è£½å“å */}
              <div className="flex items-center gap-2">
                <label className="text-sm whitespace-nowrap">è£½å“å:</label>
                <select
                  value={searchParams.è£½å“å}
                  onChange={(e) => setSearchParams({ ...searchParams, è£½å“å: e.target.value })}
                  className="flex-1 border-2 border-[#808080] border-t-[#000000] border-l-[#000000] border-b-[#ffffff] border-r-[#ffffff] px-2 py-1 bg-white text-sm"
                >
                  <option value=""></option>
                  <option value="åºƒã‚¹ãƒšãƒ¼ã‚¹ãƒã‚¦ã‚¹">åºƒã‚¹ãƒšãƒ¼ã‚¹ãƒã‚¦ã‚¹</option>
                  <option value="ã‚­ãƒ£ãƒãƒãƒ¼ãƒˆ">ã‚­ãƒ£ãƒãƒãƒ¼ãƒˆ</option>
                </select>
              </div>

              {/* å¤§ãã• */}
              <div className="flex items-center gap-2">
                <label className="text-sm whitespace-nowrap">å¤§ãã•:</label>
                <select
                  value={searchParams.å¤§ãã•}
                  onChange={(e) => setSearchParams({ ...searchParams, å¤§ãã•: e.target.value })}
                  className="flex-1 border-2 border-[#808080] border-t-[#000000] border-l-[#000000] border-b-[#ffffff] border-r-[#ffffff] px-2 py-1 bg-white text-sm"
                >
                  <option value=""></option>
                  <option value="2050">2 0 5 0</option>
                  <option value="5060">5 0 6 0</option>
                  <option value="7060">7 0 6 0</option>
                  <option value="9050">9 0 5 0</option>
                </select>
              </div>

              {/* ä»•æ§˜ */}
              <div className="flex items-center gap-2">
                <label className="text-sm whitespace-nowrap">ä»•æ§˜:</label>
                <select
                  value={searchParams.ä»•æ§˜}
                  onChange={(e) => setSearchParams({ ...searchParams, ä»•æ§˜: e.target.value })}
                  className="flex-1 border-2 border-[#808080] border-t-[#000000] border-l-[#000000] border-b-[#ffffff] border-r-[#ffffff] px-2 py-1 bg-white text-sm"
                >
                  <option value=""></option>
                  <option value="2019å¹´10æœˆæ”¹å®š">2019å¹´10æœˆæ”¹å®š</option>
                  <option value="2022å¹´10æœˆæ”¹å®š">2022å¹´10æœˆæ”¹å®š</option>
                </select>
              </div>

              {/* æ¤œç´¢å®Ÿè¡Œãƒœã‚¿ãƒ³ */}
              <div className="flex items-center">
                <button
                  onClick={handleSearch}
                  className="border-2 border-[#ffffff] border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080] px-4 py-1 bg-[#c0c0c0] text-sm active:border-t-[#808080] active:border-l-[#808080] active:border-b-[#ffffff] active:border-r-[#ffffff]"
                >
                  æ¤œç´¢å®Ÿè¡Œ
                </button>
              </div>
            </div>
          </div>

          {/* æ¤œç´¢çµæœãƒ†ãƒ¼ãƒ–ãƒ« */}
          <div className="border-2 border-[#808080] border-t-[#000000] border-l-[#000000] border-b-[#ffffff] border-r-[#ffffff] bg-white overflow-auto" style={{ height: '400px' }}>
            <table className="w-full text-xs border-collapse">
              <thead className="sticky top-0">
                <tr className="bg-[#c0c0c0]">
                  <th className="border border-[#808080] px-2 py-1 font-normal whitespace-nowrap">å›³ç•ª</th>
                  <th className="border border-[#808080] px-2 py-1 font-normal whitespace-nowrap">æ©Ÿç¨®</th>
                  <th className="border border-[#808080] px-2 py-1 font-normal whitespace-nowrap">å¤§ãã•</th>
                  <th className="border border-[#808080] px-2 py-1 font-normal whitespace-nowrap">è¦‹ç©ç•ªå·</th>
                  <th className="border border-[#808080] px-2 py-1 font-normal whitespace-nowrap">è£½å›³è€…</th>
                  <th className="border border-[#808080] px-2 py-1 font-normal whitespace-nowrap">ä½œæˆå¹´æœˆæ—¥</th>
                  <th className="border border-[#808080] px-2 py-1 font-normal whitespace-nowrap">ä»•æ§˜å¤‰æ›´</th>
                  <th className="border border-[#808080] px-2 py-1 font-normal whitespace-nowrap">å–¶æ¥­æ‰€</th>
                  <th className="border border-[#808080] px-2 py-1 font-normal whitespace-nowrap">ç‰¹åˆ¥ä»•æ§˜2-3</th>
                  <th className="border border-[#808080] px-2 py-1 font-normal whitespace-nowrap">ç‰¹åˆ¥ä»•æ§˜2-4</th>
                  <th className="border border-[#808080] px-2 py-1 font-normal whitespace-nowrap">ç‰¹åˆ¥ä»•æ§˜2-7</th>
                  <th className="border border-[#808080] px-2 py-1 font-normal whitespace-nowrap">ç‰¹åˆ¥ä»•æ§˜2-8</th>
                  <th className="border border-[#808080] px-2 py-1 font-normal whitespace-nowrap">ç‰¹åˆ¥ä»•æ§˜3-0</th>
                </tr>
              </thead>
              <tbody>
                {results.map((row, index) => (
                  <tr
                    key={index}
                    className={`cursor-pointer ${selectedRow === index ? 'bg-[#000080] text-white' : 'hover:bg-[#e0e0e0]'}`}
                    onClick={() => setSelectedRow(index)}
                  >
                    <td className="border border-[#808080] px-2 py-1 whitespace-nowrap">{row.å›³ç•ª}</td>
                    <td className="border border-[#808080] px-2 py-1 whitespace-nowrap">{row.æ©Ÿç¨®}</td>
                    <td className="border border-[#808080] px-2 py-1 whitespace-nowrap">{row.å¤§ãã•}</td>
                    <td className="border border-[#808080] px-2 py-1 whitespace-nowrap">{row.è¦‹ç©ç•ªå·}</td>
                    <td className="border border-[#808080] px-2 py-1 whitespace-nowrap">{row.è£½å›³è€…}</td>
                    <td className="border border-[#808080] px-2 py-1 whitespace-nowrap">{row.ä½œæˆå¹´æœˆæ—¥}</td>
                    <td className="border border-[#808080] px-2 py-1 whitespace-nowrap">{row.ä»•æ§˜å¤‰æ›´}</td>
                    <td className="border border-[#808080] px-2 py-1 whitespace-nowrap">{row.å–¶æ¥­æ‰€}</td>
                    <td className="border border-[#808080] px-2 py-1 whitespace-nowrap">{row.ç‰¹åˆ¥ä»•æ§˜23}</td>
                    <td className="border border-[#808080] px-2 py-1 whitespace-nowrap">{row.ç‰¹åˆ¥ä»•æ§˜24}</td>
                    <td className="border border-[#808080] px-2 py-1 whitespace-nowrap">{row.ç‰¹åˆ¥ä»•æ§˜27}</td>
                    <td className="border border-[#808080] px-2 py-1 whitespace-nowrap">{row.ç‰¹åˆ¥ä»•æ§˜28}</td>
                    <td className="border border-[#808080] px-2 py-1 whitespace-nowrap">{row.ç‰¹åˆ¥ä»•æ§˜30}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          {/* ãƒ•ãƒƒã‚¿ãƒ¼ */}
          <div className="border-2 border-[#808080] border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080] bg-[#c0c0c0]">
            {/* é¸æŠã•ã‚ŒãŸå›³é¢æƒ…å ± */}
            <div className="border-2 border-[#808080] border-t-[#000000] border-l-[#000000] border-b-[#ffffff] border-r-[#ffffff] bg-white px-2 py-1 text-xs flex items-center gap-3 m-2">
              {selectedRow !== null && (
                <>
                  <span>{results[selectedRow].å›³ç•ª}</span>
                  <span>{results[selectedRow].æ©Ÿç¨®}</span>
                  <span>{results[selectedRow].å¤§ãã•}</span>
                  <span>{results[selectedRow].è¦‹ç©ç•ªå·}</span>
                  <span>è£½å›³è€…:{results[selectedRow].è£½å›³è€…}</span>
                  <span>{results[selectedRow].ä½œæˆå¹´æœˆæ—¥}</span>
                  <span>{results[selectedRow].ä»•æ§˜å¤‰æ›´}</span>
                  <span>{results[selectedRow].å–¶æ¥­æ‰€}</span>
                </>
              )}
            </div>

            {/* ãƒœã‚¿ãƒ³ç¾¤ */}
            <div className="p-2 flex items-center justify-between">
              <div className="flex gap-2">
                <button className="border-2 border-[#ffffff] border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080] px-3 py-1 bg-[#c0c0c0] text-xs active:border-t-[#808080] active:border-l-[#808080] active:border-b-[#ffffff] active:border-r-[#ffffff]">
                  æŒ‡å®šæ¤œç´¢
                </button>
                <button className="border-2 border-[#ffffff] border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080] px-3 py-1 bg-[#c0c0c0] text-xs active:border-t-[#808080] active:border-l-[#808080] active:border-b-[#ffffff] active:border-r-[#ffffff]">
                  æ¨™æº–æ¤œç´¢
                </button>
                <button className="border-2 border-[#ffffff] border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080] px-3 py-1 bg-[#c0c0c0] text-xs active:border-t-[#808080] active:border-l-[#808080] active:border-b-[#ffffff] active:border-r-[#ffffff]">
                  å±¥æ­´ç™»éŒ²
                </button>
                <button className="border-2 border-[#ffffff] border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080] px-3 py-1 bg-[#c0c0c0] text-xs active:border-t-[#808080] active:border-l-[#808080] active:border-b-[#ffffff] active:border-r-[#ffffff]">
                  å›³é¢å‰Šé™¤
                </button>
                <button className="border-2 border-[#ffffff] border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080] px-3 py-1 bg-[#c0c0c0] text-xs active:border-t-[#808080] active:border-l-[#808080] active:border-b-[#ffffff] active:border-r-[#ffffff]">
                  å›³é¢å‡ºåŠ›
                </button>
                <button className="border-2 border-[#ffffff] border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080] px-3 py-1 bg-[#c0c0c0] text-xs active:border-t-[#808080] active:border-l-[#808080] active:border-b-[#ffffff] active:border-r-[#ffffff]">
                  CSVå‡ºåŠ›
                </button>
                <button className="border-2 border-[#ffffff] border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080] px-3 py-1 bg-[#c0c0c0] text-xs active:border-t-[#808080] active:border-l-[#808080] active:border-b-[#ffffff] active:border-r-[#ffffff]">
                  &/Ié€£æº
                </button>
              </div>
              <div className="flex gap-2">
                <button className="border-2 border-[#ffffff] border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080] px-4 py-1 bg-[#c0c0c0] text-xs active:border-t-[#808080] active:border-l-[#808080] active:border-b-[#ffffff] active:border-r-[#ffffff]">
                  èµ·å‹•
                </button>
                <button className="border-2 border-[#ffffff] border-t-[#ffffff] border-l-[#ffffff] border-b-[#808080] border-r-[#808080] px-4 py-1 bg-[#c0c0c0] text-xs active:border-t-[#808080] active:border-l-[#808080] active:border-b-[#ffffff] active:border-r-[#ffffff]">
                  ã‚„ã‚Šç›´
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
